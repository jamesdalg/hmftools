# Personalized Report On Treatment and Eligibility for Clinical Trials

PROTECT determines the clinical evidence applicable for a particular tumor sample based on all genomic events and signatures 
that are determined by the Hartwig pipeline. PROTECT works exclusively on a clinical database generated by [SERVE](../serve/README.md) 
and uses a set of rules to match the various types of evidence from SERVE against genomic events.

## Contents
 - [How is evidence matched against genomic events?](#evidence-determination-per-type-of-genomic-event)
 - [When is evidence considered on-label?](#determining-whether-evidence-is-on-label)
 - [What evidence is considered relevant for reporting?](#evidence-consolidation-filtering-and-reporting)
 - [What output is produced by PROTECT?](#protect-output)
 - [Version history and download links](#version-history-and-download-links)

## Evidence determination per type of genomic event

Genomic events are categorized in six categories and evidence is matched for every category independently.

#### SNVs and (small) INDELs

For small variants (SNVs and INDELs) determined by [PURPLE](../purple/README.md) the following matching is performed:
 - If the evidence is defined on the exact variant (hotspot) then evidence is always considered applicable
 - If the variant falls within the range in which the evidence is applicable then the evidence is applicable if the variant mutation type
 passes the filter defined as part of the SERVE evidence rule.
 - If a variant affects a gene for which evidence is applicable on a gene level (activation, inactivation, or any mutation), 
 then the evidence is considered applicable if the combination of variants affecting that gene have a high driver likelihood (> 80%). 
 
Do note that germline and somatic variants are treated equally. It is not considered relevant for clinical evidence whether the variant is 
present in the germline already or has been acquired by the tumor somatically.   

#### Copy numbers

Evidence on amplifications and deletions is considered applicable in case a gene has been classified as amplified or deleted by 
[PURPLE](../purple/README.md). In addition, a deletion is assumed to inactivate a gene and hence evidence on 
gene inactivation is considered applicable in case of a deletion. 

#### Homozygous disruptions

When a gene has been homozygously disrupted according to [LINX](../linx/README.md), evidence is applicable when it has been defined 
on a gene level with event either inactivation, deletion or any mutation. 

#### Fusions

For fusions that are deemed reportable according to [LINX](../linx/README.md) the following matching is performed:
 - Evidence defined on a promiscuous gene level is always considered applicable if a fusion with that gene is reported either in 5' or 3' 
 position.
 - Evidence that is applicable on an exact fusion pair has to match with the actual fusion pair, and also has to match the (optional) 
 exonic range defined as a restriction on the evidence.

#### Viral presence

For matching viral presence to evidence, the interpretation by [Virus Interpreter](../virus-interpreter/README.md) is used. If virus 
interpreter classified at least one viral presence as "HPV" then any evidence for "HPV Positive" will match for this sample.  Evidence on 
viral presence is only reported in case the virus itself is reported and has been assigned HIGH driver likelihood. 

#### Signatures

Evidence on signatures is matched based on the comparator and cutoff defined by the evidence rule. 
If the evidence rule provides no comparator and cutoff, the interpretation of the algorithm producing the signature is used to match.  

## Determining whether evidence is on-label

Evidence is considered on-label in case the evidence is defined for the tumor type of the sample that is evaluated, or for any tumor type
that is a parent of the sample tumor type. For example, evidence on solid tumors is considered applicable for a colorectal cancer sample 
since a solid tumor is a parent of colorectal cancer.

PROTECT uses DOID exclusively for matching and expects every evidence to be defined for a single DOID entry. 

Some additional notes:
 - Since tumors could belong to multiple separate branches in the DOID tree, a tumor sample is allowed to have multiple DOIDs. In this case
 evidence is on-label in case one of the DOIDs matches with the evidence tumor type (or is child thereof).
 - The tumor sample DOIDs are optional in the PROTECT algorithm. If they are not provided, all evidence is considered off-label 
 (including evidence that is applicable pan-cancer).

## Evidence consolidation, filtering and reporting

After evidence has been collected based on the distinct categories of genomic mutations and has been labeled as on-label or off-label,
evidence is consolidated and evaluated for reporting. The following steps are executed:
 1. Evidence is consolidated if the exact same evidence for the same event is found across multiple sources, 
 this evidence is consolidated in a single instance of applicable evidence where the multiple sources are merged. 
 2. Evidence is filtered for reporting in case they are based on genomic events that are not reportable.
 3. Evidence is filtered for reporting based on the maximum configured reporting level for the evidence.
     - For CKB C evidence is reported, or up to B for predicted evidence
     - For VICC, ACTIN and iClusion evidence is reported up to B level.
     - For all other sources evidence is reported for A level only.
 4. For every gene/event/treatment/direction combination only the highest on-label level of evidence is reported:
     - All separate responsive and resistant directions are grouped for this filtering step.
     - Off-label evidence is only reported in case there is no on-label evidence or the evidence level is higher than the highest on-label evidence.
 5. Clinical trials are only reported when they are on-label.
 6. There is some evidence that is never reported regardless of what event caused them or what their evidence level is. These are:
    - Evidence based on an event affecting TP53.
    - Evidence for non-specific chemotherapy, aspirin or steroids. 
    
## PROTECT output

PROTECT produces a tsv with every applicable evidence after consolidation has been performed. 

Field  | Description | Example
---|---|---
gene | The gene which is impact by the genomic event (empty for signatures) | BRAF
transcript | The impacted transcript of the genomic event | ENST00000288602
isCanonical | Whether the impacted transcript is the canonical transcript for the gene | true/false
event  | The genomic event for which evidence is applicable | p.Val600Glu
eventIsHighDriver | Whether the genomic event has a high driver likelihood in the tumor | true/false
germline | Whether the genomic event is present in the germline or was acquired somatically | true/false
reported | Whether the evidence passed all filters for reporting | true/false
treatment | Name of the treatment (trial or drug(s)) | Vemurafenib
onLabel | Whether the evidence is valid for the specific tumor for which the match has been made | true/false
level | Evidence level (from A (highest) to D (lowest)) | A
direction | Whether the evidence is responsive or resistant | RESPONSIVE
sources | Information from the sources | -

The list of sources contains the following information per source:

Field  | Description | Example
---|---|---
name | The name of the source from where the evidence has been extracted from | CKB
sourceEvent | The event as originally defined by the source (prior to any interpretation) | BRAF V600X
sourceUrls | A list of urls towards the source for the extracted evidence | https://ckb.jax.org
evidenceType  | The type of type as defined by the source | CODON_MUTATION
rangeRank | In case of EXON or CODON, the index of the exon or codon on which this evidence was based | 600
evidenceUrls | A list of urls with additional information about the evidence | https://pubmed.ncbi.nlm.nih.gov

## Version History and Download Links
- (Upcoming)
  - Support matching of HLA matching 
  - Make distinction of amplification verus over-expression and deletion versus under-expression
- [2.2](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v2.2)
  - Fixed bug in hotspot matching in case everything matches except for the alt (eg V600K against V600R).
  - Add consolidation for no benefit evidence.
  - Add support for matching evidence for low TML, low TMB and MSS (reported always false)
- [2.1](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v2.1)
  - Annotate whether evidence is based on a high driver event 
  - Extract the impacted transcript of the genomic event (relevant for determining if the event is based on CDKN2A p14Arf/CDKN2A p16)
  - Determine if the genomic event is based on the canonical transcript 
  - Include the source information in a separate list. 
  - Support the comparator/cut-offs for signatures which are evidence-specific
- [2.0](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v2.0)
   - New datamodel supporting evidence types, range ranks and explicit genes. 
   - Support for virus interpreter v1.2
   - Responsive and resistant directions are grouped when selecting highest level evidence for reporting
- [1.9](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.9)
  - A release that is technically compatible with SERVE v1.8
- [1.8](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.8)
  - Support for [PAVE](../pave/README.md). 
  - Handle multiple drivers per gene where non-canonical transcripts are included. 
  Current behaviour is to ignore non-canonical transcript drivers. 
- [1.7](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.7)
  - Add filter for gene level matches to require coding or splicing impact 
- [1.6](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.6)
  - Fix bug in case of viruses being presented to PROTECT with no interpretation 
- [1.5](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.5)
  - Support virus interpreter v1.1
  - Use all called somatic variants in PROTECT, but all unreported events with evidence will set to not-reportable 
- [1.4](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.4)
  - Output of virus interpreter is loaded by PROTECT and matched against viral evidence
  - Evidence is determined for non-reported genomic events (amps, dels, variants, fusions, viral presence).
  - Evidence on gene DELETION is considered applicable for homozygous disruptions
  - Maximum reporting levels are configured per SERVE source (C for CKB, B for iClusion/VICC, A for all others)
  - Ref genome version should be configured externally rather than be inferred by PROTECT  
- [1.3](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.3)
  - Renamed actionable signatures to actionable characteristics
  - Switch from BACHELOR germline variants to SAGE/PURPLE germline variants
  - Renamed linx file from linx driver to linx driver catalog 
- [1.2](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.2)
  - Treat partial amplifications and full amplifications identically
  - Removing specific evidence filtering, because this is already applied into SERVE
- [1.1](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.1) 
  - Split up database loading from running PROTECT 
- [1.0](https://github.com/hartwigmedical/hmftools/releases/tag/protect-v1.0)
  - Initial release